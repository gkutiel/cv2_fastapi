<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebCam</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }

        .info {
            display: flex;
            flex-direction: column;
            margin-bottom: 20px;
            font-size: 2em;
            width: 20em;
            font-family: 'Courier New', Courier, monospace;
        }

        #ears {
            width: 100%;
            display: flex;
            justify-content: space-between;
        }

        #crop {
            height: 300px;
            margin-top: 20px;
        }
    </style>
</head>

<body>
    <img id='vid' />
    <div class="info">
        <table>
            <tr>
                <th></th>
                <th>X</th>
                <th>Y</th>
                <th>Z</th>
            </tr>
            <tr>
                <td>Translation</td>
                <td id="trans_x"></td>
                <td id="trans_y"></td>
                <td id="trans_z"></td>
            </tr>
        </table>
    </div>

    <img id='crop' />
    <div class="info">
        <table>
            <tr>
                <th></th>
                <th>X</th>
                <th>Y</th>
                <th>Z</th>
            </tr>
            <tr>
                <td>Rotation</td>
                <td id="rot_x"></td>
                <td id="rot_y"></td>
                <td id="rot_z"></td>
            </tr>
        </table>

        <div id="ears">
            <p id="left_ear"></p>
            <p id="right_ear"></p>
        </div>
    </div>
</body>

<script>
    function set(id, val) {
        try {
            document.getElementById(id).innerText = val
        }
        catch (e) {
            console.error(e)
        }
    }

    const ws = new WebSocket("ws://localhost:8000/ws");

    ws.onmessage = (event) => {
        const vid = document.getElementById('vid')
        const crop_el = document.getElementById('crop')
        const { img, crop, ear_left, ear_right, trans, rot } = JSON.parse(event.data)

        vid.src = `data:image/jpg;base64,${img}`
        if (!crop) {
            crop_el.src = 'https://theawesomedaily.com/wp-content/uploads/2017/05/funny-faces-101.jpeg'
        } else {
            crop_el.src = `data:image/jpg;base64,${crop}`
        }

        const [trans_x, trans_y, trans_z] = trans
        set('trans_x', trans_x)
        set('trans_y', trans_y)
        set('trans_z', trans_z)

        const [rot_x, rot_y, rot_z] = rot
        set('rot_x', `${rot_x}°`)
        set('rot_y', `${rot_y}°`)
        set('rot_z', `${rot_z}°`)
        set('left_ear', ear_left)
        set('right_ear', ear_right)
    };


</script>

</html>